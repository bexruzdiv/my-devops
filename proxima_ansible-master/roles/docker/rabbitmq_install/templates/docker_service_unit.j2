[Unit]
Description=Docker Service for rabbitmq
After=network.service docker.service
Requires=docker.service

[Service]
ExecStartPre=-/usr/bin/docker stop -t 60 rabbitmq
ExecStartPre=-/usr/bin/docker rm rabbitmq
ExecStart=/usr/bin/docker run \
--rm \
--name rabbitmq \
--publish {{ rabbitmq.external_port }}:5672 \
--publish 15672:15672 \
-e RABBITMQ_DEFAULT_USER={{ rabbitmq.user_name }} \
-e RABBITMQ_DEFAULT_PASS={{ rabbitmq.password }} \
-v rabbitmq-data:/var/lib/rabbitmq/ \
{% if rabbitmq.networks is defined %}
{% for network in rabbitmq.networks %}
--network {{ network }} \
{% endfor %}
{% endif %}
--log-driver 'syslog' \
--log-opt 'tag=rabbitmq' \
{{ rabbitmq.image }}

ExecReload=/usr/bin/docker restart 'rabbitmq'

Restart=always
RestartSec=20s

SuccessExitStatus=SIGKILL SIGTERM 143 137

[Install]
WantedBy=multi-user.target
WantedBy=docker.service
