[Unit]
Description=Docker Service for postgres-exporter
After=network.service docker.service
Requires=docker.service

[Service]
ExecStartPre=-/usr/bin/docker stop -t 60 postgres-exporter
ExecStartPre=-/usr/bin/docker rm postgres-exporter
ExecStart=/usr/bin/docker run \
--rm \
--name postgres-exporter \
--publish 9010:9187 \
-v /proc:/host/proc:ro \
-v /sys:/host/sys:ro \
-v /:/rootfs:ro \
--log-driver 'syslog' \
--log-opt 'tag=postgres-exporter' \
prom/postgres-exporter:latest \
--path.procfs=/host/proc \
--path.sysfs=/host/sys \
--collector.filesystem.ignored-mount-points \
"^/(sys|proc|dev|host|etc|rootfs/var/lib/docker/containers|rootfs/var/lib/docker/overlay2|rootfs/run/docker/netns|rootfs/var/lib/docker/aufs)($$|/)"
ExecStop=-/usr/bin/docker stop -t 60 postgres-exporter

ExecReload=/usr/bin/docker restart 'postgres-exporter'

Restart=always
RestartSec=20s

SuccessExitStatus=SIGKILL SIGTERM 143 137

[Install]
WantedBy=multi-user.target
WantedBy=docker.service
