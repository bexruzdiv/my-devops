route:
  group_wait: 15s
  group_interval: 15s
  repeat_interval: 15s
  group_by: ["alertname", "cluster", "service"]
  receiver: "{{ alertmanager.receiver_name }}"
  routes:
{% for jobs in prometheus.exporters %}
{% if jobs.jobname == "node" %}
{% for export in jobs.exporter %}
    - match:
        instance: "{{ export.targets }}"
      receiver: "{{ alertmanager.receiver_name }}"
      continue: true
{% endfor %}
{% endif %}
{% endfor %}
receivers:
  - name: "{{ alertmanager.receiver_name }}"
    telegram_configs:
      - send_resolved: true
        bot_token: {{ alertmanager.bot_token }}
        chat_id: {{ alertmanager.chat_id }}
        api_url: https://api.telegram.org
{% raw %}
        message: '{{ template "telegram.default.message" .}}'
{% endraw %}
        parse_mode: ""
